---
title: "cue/nocue"
author: "Ingunn Lilja Bergsdóttir"
date: "6/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dbplyr)
library(dplyr)
library(RMySQL)
library(tidyr)
library(MASS)
library(compare)
library(ggplot2)
library(rvest)
library(dplyr)
library(knitr)
library(tidyverse)
library(gridExtra)
library(kableExtra)
library(xtable)
library(car)
library(gtable)
```

```{r}
cue_nocue <- read.csv("data/answers_cue_nocue.csv")
```

```{r}
summary(cue_nocue)
```

```{r}
names(cue_nocue)
```

```{r}
cue_nocue$answerId <- as.factor(cue_nocue$answerId)
cue_nocue$lectureId <- as.factor(cue_nocue$lectureId)
cue_nocue$studentId <- as.factor(cue_nocue$studentId)
cue_nocue$questionId <- as.factor(cue_nocue$questionId)
cue_nocue$chosenAnswer <- as.factor(cue_nocue$chosenAnswer)
cue_nocue$correct <- as.integer(cue_nocue$correct)
cue_nocue$lectureVersion <- as.factor(cue_nocue$lectureVersion)
cue_nocue$cue <- as.factor(cue_nocue$cue)
```

```{r}
cue_nocue <- dplyr::select(cue_nocue, -(ugQuestionGuid))
cue_nocue <- dplyr::select(cue_nocue, -(coinsAwarded))
cue_nocue <- dplyr::select(cue_nocue, -(practice))
cue_nocue <- dplyr::select(cue_nocue, -(lectureVersion))
cue_nocue <- dplyr::select(cue_nocue, -(chosenAnswer))
```

```{r}
ggplot(data = cue_nocue, aes(x=cue, fill=correct=="1")) + geom_bar() + labs(y="Fjöldi", x="cue", fill="Rétt/Rangt")
```


```{r}
cue_nocue$cue <- as.factor(cue_nocue$cue)
ggplot(data=cue_nocue, aes(x=cue_nocue$cue, y=cue_nocue$grade, color=cue)) + geom_boxplot(outlier.colour = "blue", outlier.shape = 1) + xlab("cue") + ylab("Einkunn") + ggtitle("Einkunn með/án vísbendinga")
```

Örlítið hærri meðaleinkunn fyrir cue - munar ekki miklu.

Vil skoða hvort það skipti meira máli fyrir fólk með lægri eða hærri einkunnir að fá cue sp.

```{r}
cu1 <- filter(cue_nocue, grade<=5)
cu2 <- filter(cue_nocue, grade>=5)
```


```{r}
cu1$cue <- as.factor(cu1$cue)
ggplot(data=cu1, aes(x=cu1$cue, y=cu1$grade, color=cue)) + geom_boxplot(outlier.colour = "blue", outlier.shape = 1) + xlab("cue") + ylab("Einkunn cue1") + ggtitle("Einkunn með/án vísbendinga nemendur undir 5")
```
Hér er greinilegt að cue vísbendingarnar eru með lægri fjórðungamörk og meðaleinkunn en án cue sem er undarlegt.


```{r}
cu2$cue <- as.factor(cu2$cue)
ggplot(data=cu2, aes(x=cu2$cue, y=cu2$grade, color=cue)) + geom_boxplot(outlier.colour = "blue", outlier.shape = 1) + xlab("cue") + ylab("Einkunn cu2") + ggtitle("Einkunn með/án vísbendinga, nemendur yfir 5")
```
cue kemur miklu betur út fyrir nemendur með einkunn yfir 5.

Mögulegt að setja þetta inn sem breytu?

```{r}
med_cue <-filter(cue_nocue, cue==1)
kable(quantile(med_cue$grade, na.rm = T))
```

```{r}
an_cue <-filter(cue_nocue, cue==0)
kable(quantile(an_cue$grade, na.rm = T))
```
Nákvæm gildi á upplýsingum úr kassaritunum.

```{r}
cue_nocue %>%
  dplyr::select(qName, correct, cue) %>%
  filter(cue!=1) -> tmp
```

```{r}
table(correct=cue_nocue$correct, cue=cue_nocue$cue)
prop.table(table(correct=cue_nocue$correct, cue=cue_nocue$cue),2)
```
Tafla sem gefur tíðni hvers þáttar og svo hlutföllin.

Hér viljum við sjá hvort hlutföllin á milli séu þau sömu. rétt/rangt fyrir vísb og svo án.
```{r}
prop.test(table(cue_nocue$correct, cue_nocue$cue))
```
Samkvæmt þessu er marktækur munur á hlutföllunum.

```{r}
glm1 <- glm(correct~qName+ cue, family = "binomial", data=cue_nocue)
```

```{r}
broom::tidy(glm1, exp = T)
```

```{r}
broom::augment(glm1, exp=T)
```

Calibration (kvörðun)

```{r}
tibble(actual = cue_nocue$correct,
       predicted = predict(glm1, type = 'response')) %>%
  ggplot(aes(x = predicted, y = actual)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, lty = 2) +
  geom_smooth()
```


AUC

```{r}
library(pROC)
```

```{r}
roc(cue_nocue$correct, predict(glm1, type = 'response'))
```

ROCR t að plotta Roc curve

```{r}
# brier
mean((cue_nocue$correct - predict(glm1, type = 'response'))^2)
```
brier skorið.

Fara í gegnum þetta þrennt aftur og aftur þar til ég er komin með gott líkan.

```{r}
#predict(glm1, type ='response')
```

#Fallegar töflur

```{r}
cue_nocue %>%
  group_by(cue) %>%
    summarise(fjoldi=length(cue), medal_einkunn=mean(grade, na.rm = T), midgildi=median(grade, na.rm = T) ) %>%
      kable() %>%
        kable_styling(bootstrap_options = c("striped", "hover"))
```

Aftur með einkunn yfir eða undir fimm.

```{r}
cu1 %>%
  group_by(cue) %>%
    summarise(fjoldi=length(cue), medal_einkunn=mean(grade, na.rm = T), midgildi=median(grade, na.rm = T) ) %>%
      kable() %>%
        kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r}
cu2 %>%
  group_by(cue) %>%
    summarise(fjoldi=length(cue), medal_einkunn=mean(grade, na.rm = T), midgildi=median(grade, na.rm = T) ) %>%
      kable() %>%
        kable_styling(bootstrap_options = c("striped", "hover"))
```


```{r}
fit <- lm(correct ~ cue + qName, data = cue_nocue)
Anova(fit, type="III")
Anova(glm1, type="III")
```

Marktækur munur á meðaltölum fyrir bæði cue og qName.

#Hjálpa vísbendingar frekar nemum með hærri eða lægri einkunn?

```{r}
#þarf kannski ekki á þessu að halda
cue_nocue %>%
  filter(cue==0) %>%
  dplyr::select(qName, correct, grade)  -> tmp_cue

cue_nocue %>%
  filter(cue==1) %>%
  dplyr::select(qName, correct, grade)  -> tmp_nocue
```


```{r}
tmp_cue$correct <- as.integer(tmp_cue$correct)

tmp_cue %>% group_by(qName)  %>% summarise(fjöldi=length(qName), meðaltal_réttra_svara=sum(correct==1)/length(qName) ) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover"))
```



```{r}
tmp_nocue$correct <- as.integer(tmp_nocue$correct)

tmp_nocue %>% group_by(qName)  %>% summarise(fjöldi=length(qName), meðaltal_réttra_svara=sum(correct==1)/length(qName) ) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r}
tmp_cue_medal <- tmp_cue %>% 
        group_by(qName) %>% 
        summarise(
          medal = sum(correct==1)/length(qName)
        )

tmp_nocue_medal <- tmp_nocue %>% 
        group_by(qName) %>% 
        summarise(
          medal = sum(correct==1)/length(qName)
        )           
```

```{r}
cue_nocue %>%
group_by(qName, cue) %>%
  summarize(mean = mean(correct)) %>%
    ggplot(aes(x= qName, y=mean, color=cue)) +
      geom_point() +
      theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
```



