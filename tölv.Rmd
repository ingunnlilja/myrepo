---
title: "tutor-web"
author: "Ingunn Lilja Bergsdóttir"
date: "5/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dbplyr)
library(dplyr)
library(RMySQL)
library(tidyr)
library(MASS)
library(compare)
library(ggplot2)
library(rvest)
library(dplyr)
library(knitr)
library(tidyverse)
library(gridExtra)
library(kableExtra)
library(xtable)
```

```{r}
twDb<-src_mysql("tw_quizdb", host = "127.0.0.1", port = 3306, user = "ilb8", password = "AIAtKDEMe2S0I")
```

```{r}
answer <- tbl(twDb, "answer")
lecture<-tbl(twDb,"lecture")
question<-tbl(twDb,"question")
host<-tbl(twDb,"host")
coinAward<-tbl(twDb,"coinAward")
lectureGlobalSetting<-tbl(twDb,"lectureGlobalSetting")
lectureQuestions<-tbl(twDb,"lectureQuestions")
lectureSetting<-tbl(twDb,"lectureSetting")
lectureStudentSetting<-tbl(twDb,"lectureStudentSetting")
subscription<-as.data.frame(tbl(twDb,"subscription"))

lectureStudentSetting%>%group_by(key)%>%summarise(stdev=sd(value,na.rm=T),stdevlog=sd(log2(value),na.rm=T))->stdevs
hash<-read.csv("data/bighashfile.wide.txt",sep=" ",col.names = c("dir","qName","hash","hash2","hash3","numQ","notaType"),na.strings = ".")
pathQ<-unique(paste(hash$dir,hash$qName,sep=""))
plonePath<-unique(paste(hash$dir,hash$qName,sep=""))
plonePath<-as.data.frame(plonePath)
hash$plonePath<-paste(hash$dir,hash$qName,sep="")
left_join(plonePath,as.data.frame(question))->myQuestions
answer%>%filter(timeStart>"2020-01-01 00:01:01")->answerRed
answerRed<-as.data.frame(answerRed)
inner_join(answerRed,myQuestions) -> myAnswer
myAnswer<-as.data.frame(myAnswer)
inner_join(myAnswer,hash) -> fullAnswerData
fullAnswerData <- as.data.frame(fullAnswerData)
```

```{r}
#Kóðinn á bakvið cue1. Villa á select.
fullAnswerData %>%
  collect() %>%
  filter(grepl("cue", plonePath)) %>%
  select(plonePath) -> tmp
```

## WOOOOHOOOOO keyrir 

```{r}
## töflurnar með vísbendingunum, benda í plonepath
cue1 <- read.table("cue_all.txt")
cue2 <- read.table("cuelist.txt")
glimpse(cue1)
glimpse(cue2)
```
cue
```{r}
anyDuplicated(cue1)
```
Virðast ekki vera endurtekningar í cue1

```{r}
summary(cue2)
anyDuplicated(cue2$V1)
anyDuplicated(cue2$V2)
```
Endurtekingarnar í V2 eru mjög miklar. Samt er cue2 styttri en hinn????

cue 2 er með tveim dálkum þar sem seinni dálkurinn er það seinasta línan í plonepath hjá hinum.

cue_all lítur miklu betur út.

Byrja með að vinna í cue_all, get ekki sameinað eins og er. 

Allt sem er í cue_all þarf að tengjast við eitthvað í fullanswerData

Skýri V1 í cue1 plonepath, í cue2 skýri ég V1 plonepath og V2 ID

```{r}
names(cue1) <- c("plonepath")
names(cue2) <- c("plonepath", "ID")
```

```{r}
names(fullAnswerData)
```

Minnka þetta niður til að skoða fyrir minna

```{r}
fullAnswerData%>%dplyr::select(plonePath, qName)->miniA
miniA <- as.data.frame(miniA)
summary(miniA)
```

```{r}
cue1$cue <- "1"
cue2$cue <- "1"
```

```{r}
## Taka til í báðum cue listum.
cue1$plonepath <- gsub(cue1$plonepath, pattern=".cue$", replacement="")
cue2$ID <- gsub(cue2$ID, pattern=".cue$", replacement="")
cue2$plonepath <- gsub(cue2$plonepath, pattern="cue.tex:%ID$", replacement="")
```

```{r}
## Taka út tvær línur sem eru greinilega bull
cue2 <- filter(cue2, !ID == "matches")
cue2 <- filter(cue2, !plonepath == "Binary")
```

```{r}
plone <- cue2%>%pull(ID)
```

```{r}
tenging <- miniA[grep(paste(plone,collapse = "|"),miniA$qName),]
```

```{r}
teng <- miniA[unique(grep(paste(plone, collapse="|"), miniA$qName)),]
```

```{r}
data <- filter(miniA, grepl(paste(plone,collapse = "|"),miniA$qName))
```

```{r}
tbl(twDb,"question")%>%collect()%>%filter(grepl("cue", plonePath)) -> cue
```

Fann questionId með þessu!!!!!!!!!!!!!!

Þá er að tengja questionId við fullanswerdata.

```{r}
left_join(cue,fullAnswerData)->virkar
inner_join(cue, fullAnswerData, by="questionId") -> kannski
```

```{r}
ID <- cue%>%pull(questionId)
```

```{r}

```

