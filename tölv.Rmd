---
title: "tutor-web"
author: "Ingunn Lilja Bergsdóttir"
date: "5/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dbplyr)
library(dplyr)
library(RMySQL)
library(tidyr)
library(MASS)
library(ggplot2)
library(rvest)
library(dplyr)
library(knitr)
library(tidyverse)
library(gridExtra)
library(kableExtra)
library(xtable)
```

```{r}
twDb<-src_mysql("tw_quizdb", host = "127.0.0.1", port = 3306, user = "ilb8", password = "AIAtKDEMe2S0I")
```

```{r}
answer <- tbl(twDb, "answer")
lecture<-tbl(twDb,"lecture")
question<-tbl(twDb,"question")
host<-tbl(twDb,"host")
coinAward<-tbl(twDb,"coinAward")
lectureGlobalSetting<-tbl(twDb,"lectureGlobalSetting")
lectureQuestions<-tbl(twDb,"lectureQuestions")
lectureSetting<-tbl(twDb,"lectureSetting")
lectureStudentSetting<-tbl(twDb,"lectureStudentSetting")
subscription<-as.data.frame(tbl(twDb,"subscription"))

lectureStudentSetting%>%group_by(key)%>%summarise(stdev=sd(value,na.rm=T),stdevlog=sd(log2(value),na.rm=T))->stdevs
hash<-read.csv("bighashfile.wide.txt",sep=" ",col.names = c("dir","qName","hash","hash2","hash3","numQ","notaType"),na.strings = ".")
pathQ<-unique(paste(hash$dir,hash$qName,sep=""))
plonePath<-unique(paste(hash$dir,hash$qName,sep=""))
plonePath<-as.data.frame(plonePath)
hash$plonePath<-paste(hash$dir,hash$qName,sep="")
left_join(plonePath,as.data.frame(question))->myQuestions
answer%>%filter(timeStart>"2020-01-01 00:01:01")->answerRed
answerRed<-as.data.frame(answerRed)
inner_join(answerRed,myQuestions) -> myAnswer
myAnswer<-as.data.frame(myAnswer)
inner_join(myAnswer,hash) -> fullAnswerData
fullAnswerData <- as.data.frame(fullAnswerData)
```

```{r}
##question %>%
  ##collect() %>%
  ##filter(grepl("cue", plonePath)) %>%
  ##select(plonePath) -> tmp
```


## WOOOOHOOOOO keyrir 

```{r}
cue1 <- read.table("cue_all.txt")
cue2 <- read.table("cuelist.txt")
names(cue1)
names(cue2)
```

```{r}
nrow(cue1)
```

```{r}
nrow(cue2)
```

```{r}
str(cue1)
```
Virðast ekki vera endurtekningar í cue1

```{r}
summary(cue2)
```
cue2 er með tveim vigrum þar sem ég er ekki viss hvor er hvað og það er greinilega haugur af endurtekningum. Endurtekingarnar í V2 eru mjög miklar. Samt er cue2 styttri en hinn????

```{r}
anyDuplicated(cue1)
anyDuplicated(cue2$V1)
anyDuplicated(cue2$V2)
fullAnswerData$plonePath <- as.factor(fullAnswerData$plonePath)
str(fullAnswerData$plonePath)
anyDuplicated(fullAnswerData$plonePath)
```

cue_all lítur miklu betur út.

Byrja með að vinna í cue_all, get ekki sameinað eins og er. 

Allt sem er í cue_all þarf að tengjast við eitthvað í fullanswerData

```{r}
names(fullAnswerData)
```

```{r}
fullAnswerData%>%dplyr::select(plonePath,questionId)->miniA
miniA<-as.data.frame(miniA)
```

 
##ID_Nj <- miniA[grep(paste(Qgen_Nj,collapse = "|"),miniA$plonePath),]
##ID_Nj

#question-ID hjá NOTA+ spurningum
##qID_Nj <- ID_Nj%>%pull(questionId)
##qID_Nj

#spurningarnar á NOTA+
##spr_Nj <- myQuestions%>%filter(questionId %in% qID_Nj)
##spr_Nj

##allt klabbið á NOTA+
##svör_Nj <- myAnswer%>%filter(questionId %in% qID_Nj)
##svör_Nj

##Qgen <- hashes%>%pull(qName)


Langar að tengja samana cue við eitthvað annað.

Er komið með töflu sem heitir hash (bighashfile) töflu sem heitir cue(cue_all) og svo grunn breyturnar sem komnar eru úr sjálfum gagnagrunninum.

Tengja saman spurningar?

Cue bendir á spurningar sem höfðu vísbendingar.

Búa til nýja hash skrá.

Qgen gæti tengst

Inní my answers er samband 

inner join á cue eða að minnsta kosti leita að duplicates.

cue-in liggja í plonepath.

```{r}
##fullAnswerData$plonePath
```

